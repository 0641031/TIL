### Cookie, Session

HTTP의 stateless, connectionless 속성을 보안하여 상태를 유지하기 위해 정보를 cookie 또는 session으로 관리할 수 있다.


1. Cookie
	* 웹서버에서 브라우저로 보내는 키와 값이 들어있는 데이터문자열.
	* 구성요소 : Name(필수), Value(필수), Expires, Domain, Path, Secure, Httponly
		1. Expires : 쿠키가 언제 삭제되는지 결정.
		2. Domain : 쿠키가 사용되는 도메인을 지정. 다른 도메인의 쿠키를 사용하지 못하게 설정.
		3. Path : 쿠키를 반환할 경로설정. path가 일치하지 않을경우에는 쿠키전송 x.
		4. Secure : 보안연결 설정. HTTPS에서만 사용. 쿠키정보가 암호화되서 전송.
		5. HttpOnly : Http외에 다른 통신 사용가능 설정. 
	* 'Set-Cookie'라는 Http헤더의 형식으로 웹서버에서 전송.
	* 쿠키에 만료일이 지정되어 있지 않으면 세션쿠키. 메모리에 저장되며 디스크에 기록되지 않음. 브라우저를 닫는 순간 쿠키는 영구적으로 손실.
	* 쿠키에 만료일을 지정한 경우, 지정된 만료일이 되면 디스크에서 쿠키가 제거됨.
	* Third-Party Cookie : 방문하지 않은 도메인의 쿠키. A라는 사이트를 방문한 경우, iframe 등으로 직접 방문하지 않은 B의 쿠키가 전송됨. 
		
		A에 있는 광고배너를 클릭해서 B의 사이트에 접속했을 때, A를 통해 접속한 유입경로가 파악가능하다. 
	* 단점 : 헤더에 쿠키 정보를 추가하여 전송하므로 트래픽을 발생시킴. 결제정보 혹은 아이디, 비번을 저장하였을 때 보안상 문제가 발생할 수 있다. 


2. Session

	* 일정시간동안 같은 브라우저로부터 들어오는 요청을 하나의 상태로 보고, 그 상태를 유지시키는 기술.
	* 웹브라우저를 통해 서버에 접속한 이후부터, 브라우저를 종료할 때까지 유지되는 상태. ex) 로그인
	* HTTP Session id를 사용자의 브라우저(로컬)가 아닌 서버에 저장.
	* 로그인 했을 때, 세션 id를 생성하여 관리. 쿠키에 세션 id가 없으면 Set-Cookie로 세션 id를 클라이언트에 전송. → 클라이언트가 세션 id를 포함하여 서버에 요청을 하면, 서버에서 세션 id로 사용자 정보를 찾아서 처리함.


3.

|          | Cookie     | Session                             |
|----------|------------|-------------------------------------|
| 저장위치 | 클라이언트 | 서버                                |
| 만료시간 | 지정가능   | 지정가능하지만 브라우저 종료시 삭제 |
| 속도     | 빠름       | 서버처리가 필요하므로 쿠키보다 느림 |


* 쿠키의 사용 예 : 쇼핑몰 사이트를 이용하다보면 '최근 본 상품'목록에 내가 방문했던 상품페이지가 저장되는 걸 볼 수 있다. 브라우저를 닫았다가 다시 열어도 이 목록은 그대로 유지된다. 그러나 브라우저의 쿠키를 삭제하고 다시 방문해보면 '최근 본 상품목록'이 비어있는 걸 확인할 수 있다. 

* 세션의 사용 예 : 11번가의 경우, 로그인을 하면 '최근 본 목록'이 서버에도 저장이 되는 걸 확인할 수 있다. 로그인을 한 상태로 여러 상품 페이지를 방문하면 세션을 이용하여 서버에 저장하기 때문에 브라우저의 쿠키를 삭제해도 그 리스트를 그대로 유지가 된다. 
	1. 로그인 하지 않은 상태에서, A 상품페이지 방문. 쿠키에 저장.
	2. 로그인 → A 상품페이지가 이전에 방문 했던 페이지와 함께 서버에 저장.  
	3. 로그아웃 → 서버에 저장되었던 이전 방문내역은 쿠키에는 존재하지 않기 때문에 없어지고, 쿠키에 저장되어있는 A 방문페이지 내역만 남음.

###### reference
* [https://nesoy.github.io/articles/2017-03/Session-Cookie](https://nesoy.github.io/articles/2017-03/Session-Cookie)
* [https://asfirstalways.tistory.com/68](https://asfirstalways.tistory.com/68)
